---
# Automatically strips AI tool branding from PR titles and bodies.
# Catches "Made with Cursor", "Co-authored-by: Cursor", and similar
# patterns injected by IDE integrations.

name: Strip AI Attribution

on:
  pull_request:
    types: [opened, edited]

permissions:
  pull-requests: write

jobs:
  strip:
    runs-on: ubuntu-latest
    steps:
      - name: Clean PR title and body
        uses: actions/github-script@v7
        with:
          script: |
            const pr = context.payload.pull_request;
            let title = pr.title;
            let body = pr.body || '';
            let changed = false;

            // Patterns to strip (case-insensitive)
            const patterns = [
              /\n*Made with \[?Cursor\]?\(?https?:\/\/cursor\.com\/?\)?\s*/gi,
              /\n*Made with Cursor\s*/gi,
              /\n*Co-authored-by:\s*Cursor.*$/gim,
              /\n*Co-authored-by:\s*cursoragent.*$/gim,
              /\n*Generated by \[?Cursor\]?.*$/gim,
              /\n*Built with \[?Cursor\]?.*$/gim,
              /\n*Powered by \[?Cursor\]?.*$/gim,
            ];

            for (const pattern of patterns) {
              const newBody = body.replace(pattern, '');
              if (newBody !== body) {
                body = newBody;
                changed = true;
              }
              const newTitle = title.replace(pattern, '');
              if (newTitle !== title) {
                title = newTitle;
                changed = true;
              }
            }

            // Trim trailing whitespace/newlines left behind
            body = body.trimEnd();

            if (changed) {
              await github.rest.pulls.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                pull_number: pr.number,
                title: title,
                body: body,
              });
              core.info(`Stripped AI attribution from PR #${pr.number}`);
            } else {
              core.info('No AI attribution found â€” PR is clean');
            }
